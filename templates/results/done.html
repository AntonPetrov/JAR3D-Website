{% extends "results/base.html" %}

{% block custom_css %}
  {{ block.super }}
  <link rel="stylesheet" href="{{ STATIC_URL }}fancybox/jquery.fancybox.css" type="text/css" media="screen" />
{% endblock custom_css %}

{% block page_specific_css_class %}results-done{% endblock page_specific_css_class %}

{% block page_subtitle %}
  {{ block.super }}
  Query {{ query_info.query_id }} completed
{% endblock page_subtitle %}

{% block tabs %}
  <li><a href="#query" data-toggle="tab">Query</a></li>
  <li class="active"><a href="#results" data-toggle="tab">Results</a></li>
{% endblock tabs %}

{% block results %}

  <div id="results" class="tab-pane row active">
    <div id="model-results" class="span7">
      {% for loop in loops %}
          <div class="span7">
            <h3>Loop {{ forloop.counter }}</h3>
            <div class="span4 offset1">
              <strong>Sequence</strong>
              <span>{{ loop.sequence|linebreaks }}</span>
            </div>

            <div id="loop-{{ forloop.counter }}-results" class="span7">

              {% for result in loop.matches %}

              <div class="loop-result span7
                {% if forloop.counter|divisibleby:2 %}even-result
                {% else %}odd-result
                {% endif %}">

                  <div class="hover-link span2">
                    <label class="radio ">
                      <input type="radio" name="group"
                      id="s{{ forloop.parent.counter }}-{{ forloop.counter }}"
                      class="jmolInline"
                      data-coord={{ result.motif_id }}>
                      <strong>{{ result.motif_id }}</strong>
                      <a class="hover-link-icon" href="{{ result.motif_url }}" target="_blank">&rarr;</a>

                    </label>
                  </div>

                <div class="span7">
                  <div class="span2">
                    <a class="fancybox" rel="gallery" href="{{ result.ssurl }}"
                      title="Loop {{ forloop.parentloop.counter }} - Hit {{ forloop.counter }} - Motif {{ result.motif_id }}">
                      <img class="ss-thumbnail" src="{{ result.ssurl }}"></img>
                    </a>
                  </div>

                  <div class="span4">
                    {% if num.loop_instances == 1 %}
                      {% include "results/single_sequence.html" %}
                    {% else %}
                      {% include "results/multi_sequence.html" %}
                    {% endif %}
                  </div>
                </div>
              </div>

            {% endfor %}
            </div>
          </div>
      {% endfor %}

      <div class="span4" id="jmol">
          <script type="text/javascript">
              jmolInitialize(" http://rna.bgsu.edu/img/jmol");
              jmolSetAppletColor("#ffffff");
              jmolApplet(340, "javascript appletLoaded()");
          </script>
          <input type='button' id='neighborhood' class='btn' value="Show neighborhood">
          <input type='button' id='stereo' class='btn' value="Show stereo">
          <input type='button' id='prev' class='btn' value='Previous'>
          <input type='button' id='next' class='btn' value="Next">
          <label><input type="checkbox" id="showNtNums">Numbers</label>
      </div>
    </div>
  </div>

{% endblock results %}

{% block page_specific_js %}
    {{ block.super }}
    <script src="{{ STATIC_URL }}js/jquery.tablesorter.min.js"></script>
    <script src="{{ STATIC_URL }}js/jar3d.js"></script>
    <script src="{{ STATIC_URL }}fancybox/jquery.fancybox.pack.js"></script>
{% endblock page_specific_js %}

{% block inline_js %}
    {{ block.super }}
    <script>
      // initialize jmolTools
      $('.jmolInline').jmolTools({
          showStereoId: 'stereo',
          showNeighborhoodId: 'neighborhood',
          showNumbersId: 'showNtNums',
          showNextId: 'next',
          showPrevId: 'prev'
      });

      // make sure that jmol is ready
      function appletLoaded (){
          $('.jmolInline').first().jmolToggle();
      }
      </script>

      <script>
      // position jmol
      (function(){
          var reference = $('.loop-result').first();
          var offset_left = reference.offset().left + reference.width();
          var offset_top  = reference.offset().top;
          $('#jmol').css('position','fixed')
                    .css('left',offset_left)
                    .css('top',offset_top);
      })();

      // fancybox integration
      $(".fancybox").fancybox({
        openEffect	: 'none',
        closeEffect	: 'none'
      });

    </script>
{% endblock inline_js %}
